{"remainingRequest":"C:\\Users\\User\\Desktop\\Feez\\feez\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\User\\Desktop\\Feez\\feez\\frontend\\src\\components\\templatemgmt\\AssetAllocationDetail.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\User\\Desktop\\Feez\\feez\\frontend\\src\\components\\templatemgmt\\AssetAllocationDetail.vue","mtime":1597213670069},{"path":"C:\\Users\\User\\Desktop\\Feez\\feez\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\User\\Desktop\\Feez\\feez\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\User\\Desktop\\Feez\\feez\\frontend\\node_modules\\vuetify-loader\\lib\\loader.js","mtime":1574476662000},{"path":"C:\\Users\\User\\Desktop\\Feez\\feez\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\User\\Desktop\\Feez\\feez\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBhcGlTZXJ2aWNlIH0gZnJvbSAiQC9jb21tb24vYXBpLnNlcnZpY2UuanMiOw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJBc3NldEFsbG9jYXRpb25OYW1lRGV0YWlsIiwNCiAgcHJvcHM6IHsNCiAgICBpbnZlc3RtZW50TmFtZTogew0KICAgICAgdHlwZTogT2JqZWN0LA0KICAgICAgcmVxdWlyZWQ6IHRydWUsDQogICAgfSwNCiAgfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgYWFOYW1lczogW10sDQogICAgICBhYTogbnVsbCwNCiAgICAgIG5leHQ6IG51bGwsDQogICAgICB0b3RhbDogMCwNCiAgICB9Ow0KICB9LA0KICB3YXRjaDogew0KICAgIGludmVzdG1lbnROYW1lKCkgew0KICAgICAgdGhpcy5nZXRBQU5hbWVzKCk7DQogICAgICB0aGlzLmdldEFBTGlzdCgpDQogICAgfSwNCiAgICBhYSgpew0KICAgICAgdGhpcy5nZXRUb3RhbCgpDQogICAgfSwNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIGdldFRvdGFsKCkgew0KICAgICAgaWYgKHRoaXMuYWEpIHsNCiAgICAgICAgbGV0IHJlc3VsdCA9IDA7DQogICAgICAgIGZvciAobGV0IGl0ZW0gb2YgdGhpcy5hYSl7DQogICAgICAgICAgaWYgKCdwZXJjZW50YWdlJyBpbiBpdGVtKSB7DQogICAgICAgICAgICByZXN1bHQgKz0gTnVtYmVyKGl0ZW1bJ3BlcmNlbnRhZ2UnXSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHRoaXMudG90YWwgPSByZXN1bHQ7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLnRvdGFsID0gMDsNCiAgICAgIH0NCiAgICB9LA0KICAgIGdldEFBKGlkeCwgZmllbGQpew0KICAgICAgaWYgKHRoaXMuYWEpIHsNCiAgICAgICAgaWYgKHRoaXMuYWEubGVuZ3RoID49IGlkeCkgew0KICAgICAgICAgIHJldHVybiB0aGlzLmFhW2lkeC0xXVtmaWVsZF0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgLy8gZWxzZSB7DQogICAgICAvLyAgIHJldHVybiBudWxsDQogICAgICAvLyB9DQogICAgfSwNCiAgICBzZXRBQShpZHgsIGV2ZW50LCBmaWVsZCkgew0KICAgICAgaWYgKHRoaXMuYWEubGVuZ3RoID49IGlkeCkgew0KICAgICAgICBpZiAoZmllbGQgPT09ICduYW1lJyl7DQogICAgICAgICAgdGhpcy5hYVtpZHgtMV0ubmFtZV9pZCA9IGV2ZW50LmlkDQogICAgICAgIH0NCiAgICAgICAgdGhpcy5hYVtpZHgtMV1bZmllbGRdID0gZXZlbnQ7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBsZXQgbmV3SXRlbSA9IHt9DQogICAgICAgIGlmIChmaWVsZCA9PT0gJ25hbWUnKXsNCiAgICAgICAgICBuZXdJdGVtLm5hbWVfaWQgPSBldmVudC5pZA0KICAgICAgICB9DQogICAgICAgIG5ld0l0ZW1bZmllbGRdID0gZXZlbnQ7DQogICAgICAgIG5ld0l0ZW1bJ2ludmVzdG1lbnQnXSA9IHRoaXMuaW52ZXN0bWVudE5hbWUubGlua2VkX2ludjsNCiAgICAgICAgdGhpcy5hYS5wdXNoKG5ld0l0ZW0pOw0KICAgICAgfQ0KICAgICAgdGhpcy5nZXRUb3RhbCgpOw0KICAgIH0sDQogICAgZ2V0QUFOYW1lcygpIHsNCiAgICAgIGxldCBlbmRwb2ludCA9IG51bGwNCiAgICAgIGlmICh0aGlzLm5leHQpIHsNCiAgICAgICAgZW5kcG9pbnQgPSB0aGlzLm5leHQ7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBlbmRwb2ludCA9IGAvYXBpL2FhbmFtZS9gOw0KICAgICAgfQ0KICAgICAgYXBpU2VydmljZShlbmRwb2ludCwgIkdFVCIpLnRoZW4oZGF0YSA9PiB7DQogICAgICAgIHRoaXMuYWFOYW1lcy5wdXNoKC4uLmRhdGEucmVzdWx0cyk7DQogICAgICAgIGlmIChkYXRhLm5leHQpIHsNCiAgICAgICAgICB0aGlzLm5leHQgPSBkYXRhLm5leHQ7DQogICAgICAgICAgdGhpcy5nZXRBQU5hbWVzKCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdGhpcy5uZXh0ID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSwNCiAgICBnZXRBQUxpc3QoKSB7DQogICAgICBsZXQgZW5kcG9pbnQgPSBgL2FwaS9pbnZlc3RtZW50dGVtcGxhdGUvJHt0aGlzLmludmVzdG1lbnROYW1lLmxpbmtlZF9pbnZ9L2FhL2A7DQogICAgICBhcGlTZXJ2aWNlKGVuZHBvaW50LCAiR0VUIikudGhlbihkYXRhID0+IHsNCiAgICAgICAgdGhpcy5hYSA9IGRhdGEucmVzdWx0czsNCiAgICAgIH0pOw0KICAgIH0sDQogICAgb25TdWJtaXQoKSB7DQogICAgICBsZXQgZW5kcG9pbnQgPSBudWxsDQogICAgICBsZXQgbWV0aG9kID0gbnVsbA0KICAgICAgZm9yIChsZXQgaT0wOyBpPHRoaXMuYWEubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgaWYgKHRoaXMuYWFbaV0uaWQpIHsNCiAgICAgICAgICBlbmRwb2ludCA9IGAvYXBpL2ludmVzdG1lbnR0ZW1wbGF0ZS8ke3RoaXMuaW52ZXN0bWVudE5hbWUubGlua2VkX2ludn0vYWEvJHt0aGlzLmFhW2ldLmlkfS9gOw0KICAgICAgICAgIG1ldGhvZCA9ICJQQVRDSCI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgZW5kcG9pbnQgPSBgL2FwaS9pbnZlc3RtZW50dGVtcGxhdGUvJHt0aGlzLmludmVzdG1lbnROYW1lLmxpbmtlZF9pbnZ9L2FhL2A7DQogICAgICAgICAgbWV0aG9kID0gIlBPU1QiOw0KICAgICAgICB9DQogICAgICAgIGFwaVNlcnZpY2UoZW5kcG9pbnQsIG1ldGhvZCwgdGhpcy5hYVtpXSkudGhlbihkYXRhID0+IHsNCiAgICAgICAgICB0aGlzLmFhW2ldID0gZGF0YTsNCiAgICAgICAgICBjb25zb2xlLmxvZygiU2F2ZWQ6ICIrdGhpcy5hYVtpXS5uYW1lLm5hbWUpDQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0NCiAgfSwNCiAgbW91bnRlZCgpIHsNCiAgICB0aGlzLmdldEFBTmFtZXMoKTsNCiAgICB0aGlzLmdldEFBTGlzdCgpDQogIH0NCn07DQoNCg=="},{"version":3,"sources":["AssetAllocationDetail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6CA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AssetAllocationDetail.vue","sourceRoot":"src/components/templatemgmt","sourcesContent":["<template lang=\"html\">\r\n  <v-container >\r\n  <v-form @submit.prevent=\"onSubmit\">\r\n    <v-card class=\"pa-2\">\r\n      <v-row>\r\n        <v-col>\r\n          {{ investmentName.name }}\r\n        </v-col>\r\n        <v-col>\r\n          {{ total }}\r\n        </v-col>\r\n      </v-row>\r\n      <v-row v-for=\"n in 12\" :key=\"n\" dense>\r\n        <v-col>\r\n          <v-autocomplete\r\n            dense solo hide-details\r\n            :value = \"getAA(n, 'name')\"\r\n            @change = \"setAA(n, $event, 'name')\"\r\n            :items=\"aaNames\"\r\n            return-object\r\n            item-text=\"name\"\r\n          />\r\n        </v-col>\r\n        <v-col>\r\n          <v-text-field\r\n          number\r\n            dense solo hide-details\r\n            :value = \"getAA(n, 'percentage')\"\r\n            @change = \"setAA(n, $event, 'percentage')\"\r\n          />\r\n        </v-col>\r\n      </v-row>\r\n      <v-row>\r\n        <v-col>\r\n          <v-btn type=\"submit\" color=\"primary\">\r\n            Save\r\n          </v-btn>\r\n        </v-col>\r\n      </v-row>\r\n    </v-card>\r\n  </v-form>\r\n</v-container>\r\n</template>\r\n\r\n<script>\r\nimport { apiService } from \"@/common/api.service.js\";\r\n\r\nexport default {\r\n  name: \"AssetAllocationNameDetail\",\r\n  props: {\r\n    investmentName: {\r\n      type: Object,\r\n      required: true,\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      aaNames: [],\r\n      aa: null,\r\n      next: null,\r\n      total: 0,\r\n    };\r\n  },\r\n  watch: {\r\n    investmentName() {\r\n      this.getAANames();\r\n      this.getAAList()\r\n    },\r\n    aa(){\r\n      this.getTotal()\r\n    },\r\n  },\r\n  methods: {\r\n    getTotal() {\r\n      if (this.aa) {\r\n        let result = 0;\r\n        for (let item of this.aa){\r\n          if ('percentage' in item) {\r\n            result += Number(item['percentage']);\r\n          }\r\n        }\r\n        this.total = result;\r\n      } else {\r\n        this.total = 0;\r\n      }\r\n    },\r\n    getAA(idx, field){\r\n      if (this.aa) {\r\n        if (this.aa.length >= idx) {\r\n          return this.aa[idx-1][field]\r\n        }\r\n      }\r\n      // else {\r\n      //   return null\r\n      // }\r\n    },\r\n    setAA(idx, event, field) {\r\n      if (this.aa.length >= idx) {\r\n        if (field === 'name'){\r\n          this.aa[idx-1].name_id = event.id\r\n        }\r\n        this.aa[idx-1][field] = event;\r\n      } else {\r\n        let newItem = {}\r\n        if (field === 'name'){\r\n          newItem.name_id = event.id\r\n        }\r\n        newItem[field] = event;\r\n        newItem['investment'] = this.investmentName.linked_inv;\r\n        this.aa.push(newItem);\r\n      }\r\n      this.getTotal();\r\n    },\r\n    getAANames() {\r\n      let endpoint = null\r\n      if (this.next) {\r\n        endpoint = this.next;\r\n      } else {\r\n        endpoint = `/api/aaname/`;\r\n      }\r\n      apiService(endpoint, \"GET\").then(data => {\r\n        this.aaNames.push(...data.results);\r\n        if (data.next) {\r\n          this.next = data.next;\r\n          this.getAANames();\r\n        } else {\r\n          this.next = null;\r\n        }\r\n      });\r\n    },\r\n    getAAList() {\r\n      let endpoint = `/api/investmenttemplate/${this.investmentName.linked_inv}/aa/`;\r\n      apiService(endpoint, \"GET\").then(data => {\r\n        this.aa = data.results;\r\n      });\r\n    },\r\n    onSubmit() {\r\n      let endpoint = null\r\n      let method = null\r\n      for (let i=0; i<this.aa.length; i++) {\r\n        if (this.aa[i].id) {\r\n          endpoint = `/api/investmenttemplate/${this.investmentName.linked_inv}/aa/${this.aa[i].id}/`;\r\n          method = \"PATCH\";\r\n        } else {\r\n          endpoint = `/api/investmenttemplate/${this.investmentName.linked_inv}/aa/`;\r\n          method = \"POST\";\r\n        }\r\n        apiService(endpoint, method, this.aa[i]).then(data => {\r\n          this.aa[i] = data;\r\n          console.log(\"Saved: \"+this.aa[i].name.name)\r\n        });\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.getAANames();\r\n    this.getAAList()\r\n  }\r\n};\r\n\r\n</script>\r\n"]}]}